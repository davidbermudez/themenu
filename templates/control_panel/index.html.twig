{% extends 'base.html.twig' %}

{% block title %}User{% endblock %}

{% block body %}

    {% include 'control_panel/header.html.twig' %}
    
    <div class="container is-fluid">
        <!-- tile -->
        <div class="tile is-ancestor">
            <div class="tile is-3 is-vertical is-parent">
                <div class="tile is-child box has-background-link-light">
                    {% if business %}
                        <a href="{{ path('app_edit_business', {'hash': user.hash }) }}"><span class="icon is-size-4 is-pulled-right"><i class="fa fa-edit"></i></span></a>
                    {% endif %}
                    <p class="title">{% trans %}Cpanel.Business{% endtrans %}</p>
                    {% if business %}
                        <div class="card">                            
                            <div class="card-content">
                                <div class="content">
                                        <p class="title is-4">{{ business.caption }}</p>
                                    </div>
                                <div class="media">
                                    <div class="media-left">
                                        <figure class="image is-48x48">
                                            <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                                        </figure>
                                    </div>
                                    <div class="media-content">
                                        
                                        <p class="subtitle is-6">{{ business.address }}, {{ business.city }}</p>
                                    </div>
                                </div>
                                <div class="content">
                                    <p><ion-icon src="{{ asset('images/ico/call-sharp.svg') }}"></ion-icon> {{ business.phone }}</p>
                                    <p class="is-italic">{{ business.description }}</p>
                                    {% if business.twitterProfile %}
                                        {% set userTw = business.twitterProfile | split('/') %}
                                        <p class="overflow">
                                            <ion-icon name="logo-twitter"></ion-icon>
                                            <a href="{{business.twitterProfile}}">@{{ userTw[(userTw|length) - 1] }}</a>
                                        </p>
                                    {% endif %}
                                    {% if business.facebookProfile %}
                                        {% set userFc = business.facebookProfile | split('/') %}
                                        <p class="overflow">
                                            <ion-icon name="logo-facebook"></ion-icon>
                                            <a href="{{business.facebookProfile}}">{{ userFc[(userFc|length) - 1] }}</a>
                                        </p>
                                    {% endif %}
                                    {% if business.instagramProfile %}
                                        {% set userIn = business.instagramProfile | split('/') %}
                                        <p class="overflow">
                                            <ion-icon name="logo-instagram"></ion-icon>
                                            <a href="{{business.instagramProfile}}">{{ userIn[(userIn|length) - 1] }}</a>
                                        </p>
                                    {% endif %}
                                    {% if business.web %}
                                        <p class="overflow">
                                            <ion-icon src="{{ asset('images/ico/globe-outline.svg')}}"></ion-icon>
                                            <a href="{{business.web}}">{{ business.web }}</a>
                                        </p>
                                    {% endif %}                                    
                                </div>
                            </div>
                        </div>                        
                    {% else %}
                        <div class="field is-grouped">
                            <div class="control">
                                <button id="submitButton" class="button is-link" onclick="location.href='{{ path('app_add_business', {'hash': user.hash })}}'">{% trans %}Cpanel.Btn.Create{% endtrans %}</button>
                            </div>
                        </div>
                    {% endif %}
                    
                </div>
                <div class="tile is-child box has-background-danger-light">
                    <a href="{{ path('app_edit_user', {'hash': user.hash }) }}"><span class="icon is-size-4 is-pulled-right"><i class="fa fa-edit"></i></span></a>
                    <p class="title">{% trans %}Cpanel.User{% endtrans %}</p>
                    <label class="label">{% trans %}Cpanel.Email{% endtrans %}</label>                    
                    <p>{{ user.email }} <ion-icon src="{{ asset('images/ico/checkmark-done-sharp.svg')}}" class="has-text-success"></ion-icon></p>                    
                    <label class="label">{% trans %}Cpanel.Username{% endtrans %}</label>
                    <p>{{ user.firstname }} {{ user.lastname }}</p>
                </div>
            </div>
            <div class="tile is-parent">
                <div class="tile is-child box has-background-link-light">                    
                    <p class="title">{% trans %}Cpanel.Menu{% endtrans %}</p>
                    {% if menues|length == 0 %}
                        <label class="label">{% trans %}Cpanel.Menu.Create{% endtrans %}</label>                        
                        <div class="field is-grouped">
                            {% if business %}
                                <div class="control">
                                    <button id="submitButton" class="button is-link" onclick="location.href='{{ path('app_edit_menu', {'hash': user.hash }) }}'">{% trans %}Cpanel.Btn.CreateMenu{% endtrans %}</button>
                                </div>
                                {% if menu %}
                                    <img src="{{ qr_code_url('My QR Code') }}" height="75" width="75" />
                                {% endif %}
                            {% else %}
                                <div class="control">
                                    <button id="submitButton" class="button is-link" disabled>{% trans %}Cpanel.Btn.CreateMenu{% endtrans %}</button>
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                    <div class="tile is-ancestor">
                        {% for menu in menues %}
                            {# Al 3er elemento, crear una fila nueva #}
                            {% if loop.index == 4 %}
                                </div>
                                <div class="tile is-ancestor">
                            {% endif %}
                            <div class="tile">
                                <div class="box" style="width: 350px;">
                                    <div class="content"> 
                                        <label>{{ menu.caption }}</label>
                                        <a href="{{ path('app_edit_menu', {'hash': user.hash, 'menu_id': menu.id }) }}"><span class="icon is-size-4 is-pulled-right"><i class="fa fa-edit"></i></span></a>
                                    </div>
                                    {% set urlqr = 'https://consultalacarta.es/' ~ menu.qrCode %}
                                    <div class="card">
                                        <div class="card-image">
                                            <figure class="image image is-square">
                                                <img src="{{ qr_code_url(urlqr) }}" />
                                            </figure>
                                        </div>
                                        <div class="card-content">
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="tile is-ancestor">
                        <div class="tile">
                            <div class="box" style="width: 350px;">
                                <div class="content">
                                    {% if is_granted('ROLE_PREMIUN') %}

                                    {% else %}
                                        <div class="control">
                                            <button id="submitButton" class="button is-link" disabled>{% trans %}Cpanel.Btn.CreateMenu{% endtrans %}</button>
                                            <a href="{{ path('app_index') }}"><span class="icon is-size-4 is-pulled-right"><ion-icon src="{{asset('images/ico/diamond-outline.svg')}}"></ion-icon></span></a>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
